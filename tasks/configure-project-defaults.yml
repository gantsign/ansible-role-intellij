---
- name: create IntelliJ IDEA user options directory
  become: yes
  file:
    dest: '~{{ item.username }}/{{ intellij_user_dir }}/config/options'
    state: directory
    owner: '{{ item.username }}'
    group: '{{ item.username }}'
    mode: 'ug=rwx,o=rx'
  with_items: '{{ users }}'

- name: configure project
  become: yes
  template:
    src: project.default.xml.j2
    dest: '~{{ item.username }}/{{ intellij_user_dir }}/config/options/project.default.xml'
    force: no
    owner: '{{ item.username }}'
    group: '{{ item.username }}'
    mode: 'ug=rw,o=r'
  with_items: '{{ users }}'

- name: set default JDK
  become: yes
  become_user: '{{ item.username }}'
  intellij_set_default_jdk:
    intellij_user_dir: '{{ intellij_user_dir }}'
    jdk_name: '{{ item.intellij_default_jdk }}'
  with_items: '{{ users }}'
  when: "(item.intellij_default_jdk is defined and item.intellij_default_jdk not in (None, '', omit)) and (item.intellij_jdks is defined and item.intellij_jdks not in ([], None, '', omit))"
